name: 'ğŸŒ¸ åŠ¨æ€READMEæ›´æ–°å·¥ä½œæµ ğŸŒ¸'
on:
  schedule:
    - cron: '0 0 * * *'   # æ¯å¤© UTC 00:00 æ‰§è¡Œï¼ˆåŒ—äº¬æ—¶é—´ 08:00ï¼‰
  workflow_dispatch:
  push:
    branches:
      - main
jobs:
  update-readme:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # æ˜ç¡®æƒé™
    steps:
      - name: ğŸ”„ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: ğŸ è®¾ç½® Python ç¯å¢ƒ
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'  # ä½¿ç”¨æ›´æ–°çš„Pythonç‰ˆæœ¬
          
      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: |
          pip install requests pytz
          
      - name: âœ¨ åˆ›å»ºæ›´æ–°è„šæœ¬
        run: |
          cat > update_readme.py << 'EOF'
          import requests
          import random
          import datetime
          import pytz
          import json
          import os
          
          # æ—¶åŒº & æ—¶é—´
          tz = pytz.timezone('Asia/Shanghai')
          now = datetime.datetime.now(tz)
          
          # è·å–å¤©æ°”ï¼ˆä½¿ç”¨ wttr.inï¼‰
          def get_weather():
              try:
                  # è·å–æ›´è¯¦ç»†çš„å¤©æ°”ä¿¡æ¯
                  resp = requests.get("https://wttr.in/é‡åº†?format=j1", timeout=10)
                  if resp.status_code == 200:
                      data = resp.json()
                      current = data['current_condition'][0]
                      temp = current['temp_C']
                      desc = current['weatherDesc'][0]['value']
                      return f"ğŸŒ¤ï¸ {desc} | ğŸŒ¡ï¸ {temp}Â°C"
              except Exception as e:
                  print(f"å¤©æ°”è·å–å¼‚å¸¸: {e}")
                  # å¤‡ç”¨ç®€å•æ ¼å¼
                  try:
                      resp = requests.get("https://wttr.in/é‡åº†?format=%C+%t", timeout=5)
                      if resp.status_code == 200:
                          return resp.text.strip()
                  except:
                      pass
              return "ğŸŒ¤ï¸ æ™´æœ— | ğŸŒ¡ï¸ 20Â°C ~ 25Â°C"
          
          # è·å–è¿åŠ¿
          def get_fortune():
              fortunes = [
                  "ğŸ‰ å¤§å‰ï¼ä»Šå¤©æ˜¯å……æ»¡å¥‡è¿¹çš„ä¸€å¤©ï¼",
                  "âœ¨ ä¸­å‰ï¼å¥½äº‹å³å°†å‘ç”Ÿ~",
                  "ğŸŒŸ å°å‰ï¼ä¿æŒå¾®ç¬‘ï¼Œå¹¸è¿ä¼šçœ·é¡¾ä½ ",
                  "ğŸ’« å‰ï¼ä»Šå¤©é€‚åˆå­¦ä¹ æ–°æŠ€èƒ½",
                  "ğŸ€ æœ«å‰ï¼å¹³ç¨³åº¦è¿‡ï¼Œå°å¿ƒè°¨æ…",
                  "ğŸŒ¸ å¹³ï¼ä¿æŒå¹³å¸¸å¿ƒï¼Œä¸€åˆ‡éƒ½ä¼šå¥½çš„",
                  "ğŸ”¥ è¶…å‰ï¼ä»Šå¤©çš„ä½ å°±æ˜¯æœ€äº®çš„æ˜Ÿï¼",
                  "ğŸŒˆ å‰ç¥¥ï¼å½©è™¹æ€»åœ¨é£é›¨å",
                  "ğŸ¯ ä¸­å‰ï¼ç›®æ ‡æ˜ç¡®ï¼Œå¿…å®šæˆåŠŸ",
                  "ğŸŒ™ å°å‰ï¼æ¸©æŸ”çš„åŠ›é‡å°†ä¼´éšä½ "
              ]
              return random.choice(fortunes)
          
          # è·å–ç¼–ç¨‹åè¨€
          def get_coding_quote():
              quotes = [
                  "Code is like humor. When you have to explain it, it's bad. - Cory House",
                  "First, solve the problem. Then, write the code. - John Johnson",
                  "Experience is the name everyone gives to their mistakes. - Oscar Wilde",
                  "In order to be irreplaceable, one must always be different. - Coco Chanel",
                  "Java is to JavaScript what car is to Carpet. - Chris Heilmann",
                  "The best error message is the one that never shows up. - Thomas Fuchs"
              ]
              return random.choice(quotes)
          
          # è·å–ç»“è¯­
          def get_ending():
              endings = [
                  "ä»Šå¤©ä¹Ÿè¦å…ƒæ°”æ»¡æ»¡åœ°codingå“¦ï¼ğŸ’ª",
                  "æ„¿ä½ çš„ä»£ç æ°¸è¿œæ²¡æœ‰bug~ ğŸ›",
                  "è®°å¾—å¤šå–æ°´ï¼Œå¤šä¼‘æ¯~ ğŸ’§",
                  "Keep coding, keep growing! ğŸŒ±",
                  "Debug the world, one line at a time! ğŸ”",
                  "è®©æˆ‘ä»¬ä¸€èµ·è®©ä¸–ç•Œå˜å¾—æ›´ç¾å¥½ï¼ ğŸŒ"
              ]
              return random.choice(endings)
          
          # è·å–åŠ¨æ€å†…å®¹
          weather = get_weather()
          fortune = get_fortune()
          quote = get_coding_quote()
          ending = get_ending()
          
          # ç”Ÿæˆ README å†…å®¹
          content = f"""# ğŸŒ¸ åŠ¨æ€ README å±•ç¤º
          
          <div align="center">
          
          ![Typing SVG](https://readme-typing-svg.herokuapp.com?font=Fira+Code&pause=1000&color=FF69B4&center=true&vCenter=true&width=435&lines=Welcome+to+my+GitHub!;Always+learning+new+things;Love+to+share+knowledge)
          
          </div>
          
          ## ğŸ“Š ä»Šæ—¥ä¿¡æ¯
          
          | é¡¹ç›® | å†…å®¹ |
          |------|------|
          | ğŸ“… æ›´æ–°æ—¶é—´ | {now.strftime('%Y-%m-%d %H:%M:%S')} (UTC+8) |
          | ğŸŒ¤ï¸ ä»Šæ—¥å¤©æ°” | {weather} |
          | ğŸ”® ä»Šæ—¥è¿åŠ¿ | {fortune} |
          | ğŸ’¬ ç¼–ç¨‹åè¨€ | {quote} |
          
          ## ğŸ¯ æ¯æ—¥å¯„è¯­
          
          > {ending}
          
          ---
          
          <div align="center">
            <img src="https://github-readme-stats.vercel.app/api?username=Pine-Ln&show_icons=true&theme=radical" alt="GitHub Stats" />
          </div>
          
          <div align="center">
            <i>âœ¨ è¿™ä¸ª README é€šè¿‡ GitHub Actions è‡ªåŠ¨æ›´æ–° âœ¨</i>
          </div>
          """
          
          # å†™å…¥æ–‡ä»¶
          with open('README.md', 'w', encoding='utf-8') as f:
              f.write(content)
          
          print("âœ… README.md æ›´æ–°å®Œæˆï¼")
          print(f"ğŸ“Š å¤©æ°”: {weather}")
          print(f"ğŸ”® è¿åŠ¿: {fortune}")
          print(f"ğŸ’¬ åè¨€: {quote}")
          EOF
          
      - name: âœ¨ è¿è¡Œæ›´æ–°è„šæœ¬
        run: python update_readme.py

      - name: ğŸ“ æäº¤æ›´æ”¹
        run: |
          git config user.email "IGCrystal@wenturc.com"
          git config user.name "IGCrystal"
          git add README.md
          if ! git diff --cached --quiet; then
            git commit -m "ğŸŒ¸ è‡ªåŠ¨æ›´æ–° README - $(date '+%Y-%m-%d %H:%M:%S')"
            git push
          else
            echo "ğŸ“ README å†…å®¹æ— å˜åŒ–ï¼Œè·³è¿‡æäº¤"
          fi

      - name: ğŸ”” è¾“å‡ºç»“æœ
        if: always()
        run: |
          echo "ğŸ‰ å·¥ä½œæµæ‰§è¡Œå®Œæˆï¼"
          echo "â° æ‰§è¡Œæ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
